(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{812:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return OpenWeather}));__webpack_require__(19),__webpack_require__(18),__webpack_require__(20),__webpack_require__(27),__webpack_require__(48),__webpack_require__(16);var _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(12),_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_6__),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(9),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_7__),_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_9__=(__webpack_require__(33),__webpack_require__(14)),_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_9__),react__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(3),react__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_10__),styled_components__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(65),lodash_get__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(17),lodash_get__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(lodash_get__WEBPACK_IMPORTED_MODULE_12__),_dynamicLoaders_ComponentsFactory__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(15),_dynamicLoaders_ServiceFactory__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(1),_dynamicLoaders_verticalConstsLoader__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(155),_utils_utils_Consts__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(0),_utils_http_HttpService__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(35);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}var _getVerticalConsts=Object(_dynamicLoaders_verticalConstsLoader__WEBPACK_IMPORTED_MODULE_15__.a)("wthr"),WEATHER_API_KEY=_getVerticalConsts.WEATHER_API_KEY,FEATURE_NAME_OPEN_WEATHER_DATA_BY_COORDS=_getVerticalConsts.FEATURE_NAME_OPEN_WEATHER_DATA_BY_COORDS;class OpenWeather extends react__WEBPACK_IMPORTED_MODULE_10___default.a.Component{constructor(props){super(props);var config=this.props.config;config.hide&&(this.render=()=>null),this.state={cityId:null,isCityDataFailed:!1,units:"imperial",isCoordsFailed:!1},this.storageKeyOpenWeatherCoordsToCityDataMap=`${config.id||"OpenWeather"}__openWeatherCoordsToCityIdMap`,this.configurable={defaultCityId:2643743,widgetId:lodash_get__WEBPACK_IMPORTED_MODULE_12___default()(config,"elements.iframe.widgetId",11),height:lodash_get__WEBPACK_IMPORTED_MODULE_12___default()(config,"elements.iframe.height","240px"),inlineStyle:lodash_get__WEBPACK_IMPORTED_MODULE_12___default()(this.props,"config.style",{})},this._css=this.getMainCss(),this.APIGetCityData=this.APIGetCityData.bind(this),this.updateUserLocationData=this.updateUserLocationData.bind(this),this.artificialRefresh=this.artificialRefresh.bind(this),this.updateUserLocationData()}updateUserLocationData(){var _this=this;return _babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_9___default()(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_7___default.a.mark((function _callee(){var position,lat,lon,coords,cityData;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_7___default.a.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,_this.getCoordsFromGeolocation().catch(()=>null);case 2:if(position=_context.sent,lat=lodash_get__WEBPACK_IMPORTED_MODULE_12___default()(position,"coords.latitude"),lon=lodash_get__WEBPACK_IMPORTED_MODULE_12___default()(position,"coords.longitude"),lat&&lon||(coords=_this.getCoordsFromPrefService(),lat=coords.lat,lon=coords.lon),lat&&lon){_context.next=9;break}return _this.setState({isCoordsFailed:!0,cityId:_this.configurable.defaultCityId}),_context.abrupt("return");case 9:return lat=lat.toFixed(4),lon=lon.toFixed(4),_context.next=13,_this.getCityData(lat,lon);case 13:(cityData=_context.sent).cityId?_this.setState(cityData):_this.setState({isCityDataFailed:!0,cityId:_this.configurable.defaultCityId});case 15:case"end":return _context.stop()}}),_callee)})))()}getCoordsFromGeolocation(){return new Promise((resolve,reject)=>{navigator.geolocation.getCurrentPosition(resolve,reject)})}getMainCss(){return styled_components__WEBPACK_IMPORTED_MODULE_11__.a.div`
    height:${this.configurable.height};
    position:relative;
    iframe{
      border:none;
      width: 100%;
      height: 100%;
    }
    .error-message{
      color:white;
      position:absolute;
      bottom:0;
      padding: 5px;
      background-color: #ff4f98;
      z-index: 12;
      width:100%;
      span{
        padding-left: 45px;
      }
      button{
        color:white;
        background-color: #ff4f98;
        border-radius:3px;
        border: 1px solid white;
        :hover{
          background-color:#f784b4;
          cursor:pointer;
        }
        :focus{
          outline:none;
        }
      }
      button.x{
        float:right;
      }
      button.refresh{
        margin-left:10px;
      }
    }
   
    `}getCityData(lat,lon){var mapKey=this.coordsToStorageKeyFormat(lat,lon),cityDataFromStorage=this.storageGetCityData(mapKey);return cityDataFromStorage?Promise.resolve(cityDataFromStorage):this.APIGetCityData(lat,lon).then(_ref2=>{var units=_ref2.units,cityId=_ref2.cityId;return cityId?(this.storageAddKnownCityData(mapKey,{units:units,cityId:cityId}),{units:units,cityId:cityId}):null})}getCoordsFromPrefService(){var userGeo=_dynamicLoaders_ServiceFactory__WEBPACK_IMPORTED_MODULE_14__.a.get(_utils_utils_Consts__WEBPACK_IMPORTED_MODULE_16__.Ib).get(_utils_utils_Consts__WEBPACK_IMPORTED_MODULE_16__.kb);return{lat:userGeo.latitude,lon:userGeo.longitude}}APIGetCityData(lat,lon){var options={url:"https://api.openweathermap.org/data/2.5/weather",method:"get",params:{lat:lat,lon:lon,APPID:WEATHER_API_KEY},featureName:FEATURE_NAME_OPEN_WEATHER_DATA_BY_COORDS};return Object(_utils_http_HttpService__WEBPACK_IMPORTED_MODULE_17__.a)(options).then(res=>{var cityId=res.data.id;return{units:"US"===lodash_get__WEBPACK_IMPORTED_MODULE_12___default()(res,"data.sys.country")?"imperial":"metric",cityId:cityId}}).catch(err=>{this.setState({isCityDataFailed:!0,cityId:this.configurable.defaultCityId})})}coordsToStorageKeyFormat(lat,lon){return`${lat}-${lon}`}storageAddKnownCityData(coords,cityData){var coordsToCityDataMapUpdate=function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_6___default()(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}({},_dynamicLoaders_ServiceFactory__WEBPACK_IMPORTED_MODULE_14__.a.get(_utils_utils_Consts__WEBPACK_IMPORTED_MODULE_16__.Ib).get(this.storageKeyOpenWeatherCoordsToCityDataMap));coordsToCityDataMapUpdate[coords]=cityData,_dynamicLoaders_ServiceFactory__WEBPACK_IMPORTED_MODULE_14__.a.get(_utils_utils_Consts__WEBPACK_IMPORTED_MODULE_16__.Ib).set(this.storageKeyOpenWeatherCoordsToCityDataMap,coordsToCityDataMapUpdate)}storageGetCityData(coords){var coordsToCityDataMap=_dynamicLoaders_ServiceFactory__WEBPACK_IMPORTED_MODULE_14__.a.get(_utils_utils_Consts__WEBPACK_IMPORTED_MODULE_16__.Ib).get(this.storageKeyOpenWeatherCoordsToCityDataMap)||{};return coordsToCityDataMap[coords]?coordsToCityDataMap[coords]:null}artificialRefresh(){this.updateUserLocationData(),this.setState({cityId:""})}getIframeUrl(){var state=this.state;return`https://d2gbn9pgmbetx7.cloudfront.net/open-weather/openWeatherIframe.html?cityid=${state.cityId}&widgetid=${this.configurable.widgetId}&units=${state.units}&appid=${WEATHER_API_KEY}`}render(){var StyledOpenWeather=this._css,state=this.state,displayError=state.isCityDataFailed||state.isCoordsFailed;return react__WEBPACK_IMPORTED_MODULE_10___default.a.createElement(StyledOpenWeather,{style:this.configurable.inlineStyle},state.cityId&&react__WEBPACK_IMPORTED_MODULE_10___default.a.createElement("iframe",{title:"weather",src:this.getIframeUrl(),scrolling:"no"}),state.cityId&&displayError&&react__WEBPACK_IMPORTED_MODULE_10___default.a.createElement("div",{className:"error-message"},react__WEBPACK_IMPORTED_MODULE_10___default.a.createElement("span",null,"Wrong location? "),react__WEBPACK_IMPORTED_MODULE_10___default.a.createElement("button",{type:"button",className:"refresh",onClick:this.artificialRefresh},"Refresh"),react__WEBPACK_IMPORTED_MODULE_10___default.a.createElement("button",{type:"button",className:"x",onClick:()=>this.setState({isCityDataFailed:!1,isCoordsFailed:!1})},"X")))}}_dynamicLoaders_ComponentsFactory__WEBPACK_IMPORTED_MODULE_13__.a.add(()=>OpenWeather,"OpenWeather")}}]);