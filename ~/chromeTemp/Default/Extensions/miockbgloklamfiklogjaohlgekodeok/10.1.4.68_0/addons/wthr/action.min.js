(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{784:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _dynamicLoaders_ServiceFactory__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1),_utils_utils_Consts__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(0),_utils_http_HttpService__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(35),_utils_logger_LoggerService__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(10),_utils_utils_Utils__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(2),_dynamicLoaders_verticalConstsLoader__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(155),_getVerticalConsts=Object(_dynamicLoaders_verticalConstsLoader__WEBPACK_IMPORTED_MODULE_5__.a)("wthr"),CITY_KEY=_getVerticalConsts.CITY_KEY,FEATURE_NAME_UPDATE_WEATHER=_getVerticalConsts.FEATURE_NAME_UPDATE_WEATHER,LATITUDE_KEY=_getVerticalConsts.LATITUDE_KEY,LONGITUDE_KEY=_getVerticalConsts.LONGITUDE_KEY,UNITS_WEATHER_KEY=_getVerticalConsts.UNITS_WEATHER_KEY,WEATHER_API_KEY=_getVerticalConsts.WEATHER_API_KEY,WEATHER_TIME_KEY=_getVerticalConsts.WEATHER_TIME_KEY,WEATHER_VALUE_KEY=_getVerticalConsts.WEATHER_VALUE_KEY,UPDATE_WEATHER=_getVerticalConsts.UPDATE_WEATHER,info={weatherApiRetryCount:0,lastRetryDate:(new Date).getTime()};__webpack_exports__.default={[UPDATE_WEATHER]:function updateWeather(){var args=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},self=(arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]?arguments[2]:{});try{var prefService=_dynamicLoaders_ServiceFactory__WEBPACK_IMPORTED_MODULE_0__.a.get(_utils_utils_Consts__WEBPACK_IMPORTED_MODULE_1__.Ib),now=(new Date).getTime(),interval=9e5,prefUnit=prefService.get(UNITS_WEATHER_KEY),unit=args.unit||"{{UNITS_WEATHER}}"===prefUnit&&"metric"||prefUnit,currentUnit=self.state.isCelsius?"metric":"imperial",changedUnit=unit!==currentUnit,prefData=prefService.get(WEATHER_VALUE_KEY),prefDataTime=prefService.get(WEATHER_TIME_KEY),updateSelf=data=>{prefService.set(UNITS_WEATHER_KEY,unit),self.mounted&&data.main&&self.setState({isCelsius:"imperial"!==unit,temperature:Math.round(data.main.temp),city:data.name,icon:`url(content/images/weather/${data.weather[0].icon}.svg)`})};if(!changedUnit&&Object(_utils_utils_Utils__WEBPACK_IMPORTED_MODULE_4__.r)(prefData)&&prefDataTime&&now-prefDataTime<=interval)updateSelf(prefData);else{var geoData=prefService.get(_utils_utils_Consts__WEBPACK_IMPORTED_MODULE_1__.kb);if(!geoData[LATITUDE_KEY]||!geoData[LONGITUDE_KEY])return;var timeGapFromLastRetry=now-info.lastRetryDate;if(timeGapFromLastRetry>9e5&&(info.weatherApiRetryCount=0),info.weatherApiRetryCount>=5)return;info.weatherApiRetryCount+=1,info.lastRetryDate=(new Date).getTime();var geoData_url=`https://api.openweathermap.org/data/2.5/weather?appid=${WEATHER_API_KEY}&lat=${geoData[LATITUDE_KEY]}&lon=${geoData[LONGITUDE_KEY]}&units=${unit}&z=90883`;Object(_utils_http_HttpService__WEBPACK_IMPORTED_MODULE_2__.a)({method:"get",url:geoData_url,featureName:FEATURE_NAME_UPDATE_WEATHER}).then(res=>{var gdata=res.data;gdata.main&&(prefService.set(WEATHER_VALUE_KEY,gdata),prefService.set(WEATHER_TIME_KEY,(new Date).getTime()),prefService.set(CITY_KEY,gdata.name),updateSelf(gdata))}).catch(reason=>{self.mounted&&self.setState({isCelsius:"imperial"!==prefService.get(UNITS_WEATHER_KEY)})})}}catch(e){_utils_logger_LoggerService__WEBPACK_IMPORTED_MODULE_3__.a.track(_utils_utils_Consts__WEBPACK_IMPORTED_MODULE_1__.V,`UPDATE_WEATHER90: ${e.message}`)}}}}}]);